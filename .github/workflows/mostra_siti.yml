name: Mostra Site ID da Wix

on:
  workflow_dispatch: {}

jobs:
  show_sites:
    runs-on: ubuntu-latest
    steps:
      - name: Echo token fingerprint (per capire se il secret Ã¨ aggiornato)
        env:
          WIX_API_KEY: ${{ secrets.WIX_API_KEY }}
        run: |
          test -n "$WIX_API_KEY" || { echo "Manca il secret WIX_API_KEY"; exit 1; }
          echo -n "$WIX_API_KEY" | sha256sum | cut -c1-16 | sed 's/^/Token SHA256 (primi 16): /'

      - name: Chiedo a Wix la lista siti
        env:
          WIX_API_KEY: ${{ secrets.WIX_API_KEY }}
        run: |
          curl -sS -X GET "https://www.wixapis.com/sites/v1/sites" \
            -H "Authorization: $WIX_API_KEY" \
            -H "Content-Type: application/json" | tee /tmp/sites.json
          echo
          echo "---- Estratto utile (id | name | domain) ----"
          jq -r '.sites[] | "\(.id) | \(.name) | \(.primaryDomain.url // .domain // "")"' /tmp/sites.json
